<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dan's Retirement Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-up: radial-gradient(circle at top, #4f46e5 0%, #020617 55%, #02010a 100%);
      --bg-down: radial-gradient(circle at top, #f97316 0%, #7f1d1d 50%, #020106 100%);
      --bg-neutral: radial-gradient(circle at top, #4b5563 0%, #020617 60%, #020107 100%);
      --card-bg: rgba(15, 23, 42, 0.92);
      --card-border: rgba(148, 163, 184, 0.3);
      --accent-up: #22c55e;
      --accent-down: #ef4444;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", system-ui, sans-serif;
      color: var(--text-main);
      min-height: 100vh;
      padding: 16px;
      background: var(--bg-neutral);
      transition: background 0.6s ease;
    }

    body.trend-up { background: var(--bg-up); }
    body.trend-down { background: var(--bg-down); }
    body.trend-neutral { background: var(--bg-neutral); }

    .page {
      max-width: 1024px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 16px;
    }

    header h1 {
      margin: 0;
      font-size: 2rem;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 18px;
    }

    @media (max-width: 800px) {
      .layout { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 18px;
      padding: 16px;
    }

    .shirt-wrapper {
      position: relative;
      max-width: 420px;
      margin: 0 auto;
    }

    .shirt-wrapper img {
      width: 100%;
      border-radius: 16px;
    }

    .shirt-price-overlay {
      position: absolute;
      right: 8%;
      top: 9%;
      font-size: 1.8rem;
      font-weight: 700;
    }

    .hero-info {
      text-align: center;
    }

    .headline-price {
      font-size: 2.6rem;
      font-weight: 700;
    }

    .trend-pill {
      margin-top: 10px;
      display: inline-flex;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
      border: 1px solid transparent;
    }

    .trend-pill.up {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.6);
      color: #bbf7d0;
    }

    .trend-pill.down {
      background: rgba(239,68,68,0.18);
      border-color: rgba(239,68,68,0.6);
      color: #fecaca;
    }

    .trend-pill.neutral {
      background: rgba(148,163,184,0.15);
      border-color: rgba(148,163,184,0.5);
      color: #e5e7eb;
    }

    .hero-meta {
      margin-top: 12px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }

    th, td {
      padding: 8px;
      font-size: 0.85rem;
    }

    th { color: var(--text-muted); }

    td:last-child { text-align: right; }

  </style>
</head>

<body class="trend-neutral">
<div class="page">
  <header>
    <h1>Dan's Retirement Tracker</h1>
  </header>

  <div class="layout">
    <section class="card">
      <div class="shirt-wrapper">
        <img id="character-img" src="img/guy-up.png" alt="Silver shirt">
        <div id="shirt-price" class="shirt-price-overlay">—</div>
      </div>
    </section>

    <section class="card hero-info">
      <div>Silver spot price</div>
      <div id="headline-price" class="headline-price">—</div>

      <div id="trend-pill" class="trend-pill neutral">
        <span id="trend-arrow">⏸</span>
        <span id="trend-text">Market opens Sunday 5pm CT</span>
      </div>

      <div class="hero-meta">
        Last updated: <span id="last-updated">—</span><br>
        Updates hourly during market hours
      </div>
    </section>
  </div>

  <section class="card">
    <table>
      <thead>
        <tr>
          <th>Metal</th>
          <th style="text-align:right;">Price (USD/toz)</th>
          <th style="text-align:right;">Trend</th>
        </tr>
      </thead>
      <tbody id="metals-tbody"></tbody>
    </table>
  </section>
</div>

<script>
  const API = "https://api.dansretirement.com/";
  const body = document.body;

  const priceEls = {
    headline: document.getElementById("headline-price"),
    shirt: document.getElementById("shirt-price")
  };

  const trendPill = document.getElementById("trend-pill");
  const trendArrow = document.getElementById("trend-arrow");
  const trendText = document.getElementById("trend-text");
  const updatedEl = document.getElementById("last-updated");
  const table = document.getElementById("metals-tbody");

  function money(v) {
    if (v == null) return "—";
    return `$${Number(v).toFixed(2)}`;
  }

  function setTrend(direction) {
    trendPill.className = "trend-pill " + (direction || "neutral");

    if (direction === "up") {
      trendArrow.textContent = "↑";
      trendText.textContent = "Silver is mooning";
      body.className = "trend-up";
    } else if (direction === "down") {
      trendArrow.textContent = "↓";
      trendText.textContent = "Silver is tanking";
      body.className = "trend-down";
    } else {
      trendArrow.textContent = "⏸";
      trendText.textContent = "Market opens Sunday 5pm CT";
      body.className = "trend-neutral";
    }
  }

  function renderTable(metals) {
    table.innerHTML = "";
    for (const k of ["gold","silver","platinum","palladium"]) {
      const m = metals[k];
      if (!m) continue;
      table.innerHTML += `
        <tr>
          <td>${m.label}</td>
          <td>${money(m.price)}</td>
          <td>${m.direction === "up" ? "▲" : m.direction === "down" ? "▼" : "↔"}</td>
        </tr>`;
    }
  }

  async function load() {
    const res = await fetch(API + "?t=" + Date.now());
    const data = await res.json();

    const silver = data.metals?.silver || {};
    priceEls.headline.textContent = money(silver.price);
    priceEls.shirt.textContent = money(silver.price);
    updatedEl.textContent = data.updatedAt
      ? new Date(data.updatedAt).toLocaleString()
      : "—";

    if (data.skipped && silver.price == null) {
      setTrend("neutral");
    } else {
      setTrend(silver.direction);
    }

    renderTable(data.metals || {});
  }

  load();
</script>
</body>
</html>
